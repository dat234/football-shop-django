{% load static %}

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BODAH - Website Bán Đồ Bóng Đá</title>
    <link rel="icon" type="image/png" href="{% static 'image/favicon-96x96.png' %}" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="{% static 'image/favicon.svg' %}" />
    <link rel="shortcut icon" href="{% static 'image/favicon.ico' %}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'image/apple-touch-icon.png' %}" />
    <meta name="apple-mobile-web-app-title" content="MyWebSite" />
    <link rel="manifest" href="{% static 'image/site.webmanifest' %}" />
    
    <link rel="stylesheet" href="{% static 'css/store/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/store/footer.css' %}">
    <link rel="stylesheet" href="{% static 'css/store/home.css' %}?v=1">
    <link rel="stylesheet" href="{% static 'css/store/dark-theme.css' %}">
</head>
<body>
    {% include "layout/header.html" %}

    <main class="shop-page">
        <div class="shop-container">

            <aside class="sidebar">
                <div class="filter-group">
                    <strong>Lọc theo danh mục:</strong>
                    <ul>
                        <li>
                            <a href="{% url 'home' %}" 
                               class="{% if not current_category_id %}active{% endif %}">
                                Tất cả sản phẩm
                            </a>
                        </li>
                        {% for cat in all_categories %}
                        <li>
                            <a href="?category={{ cat.id }}{% if search_query %}&q={{ search_query }}{% endif %}" 
                               class="{% if current_category_id == cat.id %}active{% endif %}">
                                {{ cat.name }}
                            </a>
                        </li>
                        {% endfor %}
                    </ul>
                </div>

                <div class="filter-group">
                    <strong>Sắp xếp theo:</strong>
                    <ul>
                        <li>
                            <a href="?{{ query_string }}&sort=-id"
                               class="{% if current_sort == '-id' %}active{% endif %}">
                                Mới nhất
                            </a>
                        </li>
                        <li>
                            <a href="?{{ query_string }}&sort=price_asc"
                               class="{% if current_sort == 'price_asc' %}active{% endif %}">
                                Giá: Tăng dần
                            </a>
                        </li>
                        <li>
                            <a href="?{{ query_string }}&sort=price_desc"
                               class="{% if current_sort == 'price_desc' %}active{% endif %}">
                                Giá: Giảm dần
                            </a>
                        </li>
                    </ul>
                </div>
            </aside> 

            <section class="main-content">

                <form action="{% url 'home' %}" method="GET" class="search-form">
                    <input type="text" name="q" placeholder="Tìm áo đấu, giày, bóng..." value="{{ search_query|default:'' }}">
                    <button type="submit" class="btn-primary">Tìm kiếm</button>
                </form>

                <h2 class="results-header">
                    {% if search_query %}
                        Kết quả tìm kiếm cho: "{{ search_query }}"
                    {% elif current_category_id %}
                        Sản phẩm
                    {% else %}
                        Tất cả sản phẩm
                    {% endif %}
                </h2>

                <div class="product-list">
                    {% for product in page_obj %}
                        <div class="product-card">
                            <a href="{% url 'product_detail' product.id %}" style="text-decoration: none; color: inherit;">
                                <img class="product-image" 
                                    src="{{ product.image.url|default:product.image }}" 
                                    alt="{{ product.name }}">
                                <div class="product-info">
                                    <h3 class="product-name">{{ product.name }}</h3>
                                    <p class="product-price">{{ product.price|floatformat:0 }} VNĐ</p>
                                    <p class="product-stock">Kho: {{ product.stock }}</p>
                                </div>
                            </a>
                        </div>
                    {% empty %}
                        <p class="no-products-found">Không tìm thấy sản phẩm nào phù hợp.</p>
                    {% endfor %}
                </div>

                <div class="pagination">
                    {% if page_obj.has_other_pages %}
                        <ul>
                            <li><a href="?{{ query_string }}&page=1">&laquo;&laquo;</a></li>
                            
                            {% if page_obj.has_previous %}
                                <li><a href="?{{ query_string }}&page={{ page_obj.previous_page_number }}">&laquo;</a></li>
                            {% else %}
                                <li><span class="disabled">&laquo;</span></li>
                            {% endif %}

                            {% for num in page_obj.paginator.get_elided_page_range %}
                                {% if page_obj.number == num %}
                                    <li><span class="current">{{ num }}</span></li>
                                {% elif num == page_obj.paginator.ELLIPSIS %}
                                    <li><span class="disabled">{{ num }}</span></li>
                                {% else %}
                                    <li><a href="?{{ query_string }}&page={{ num }}">{{ num }}</a></li>
                                {% endif %}
                            {% endfor %}

                            {% if page_obj.has_next %}
                                <li><a href="?{{ query_string }}&page={{ page_obj.next_page_number }}">&raquo;</a></li>
                            {% else %}
                                <li><span class="disabled">&raquo;</span></li>
                            {% endif %}
                            
                            <li><a href="?{{ query_string }}&page={{ page_obj.paginator.num_pages }}">&raquo;&raquo;</a></li>
                        </ul>
                    {% endif %}
                </div>

            </section> 
        </div>
    </main> 
        
    {% include "layout/footer.html" %}
    
    <script src="{% static 'js/theme-toggle.js' %}"></script>
</body>
</html>
</html>