{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BODAH - Website Bán Đồ Bóng Đá</title>
    <link rel="icon" type="image/png" href="{% static 'image/favicon-96x96.png' %}" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="{% static 'image/favicon.svg' %}" />
    <link rel="shortcut icon" href="{% static 'image/favicon.ico' %}" />
    <link rel="apple-touch-icon" sizes="180x180" href="{% static 'image/apple-touch-icon.png' %}" />
    <meta name="apple-mobile-web-app-title" content="MyWebSite" />
    <link rel="manifest" href="{% static 'image/site.webmanifest' %}" />

    <link rel="stylesheet" href="{% static 'css/store/header.css' %}">
    <link rel="stylesheet" href="{% static 'css/store/footer.css' %}">
    <link rel="stylesheet" href="{% static 'css/store/landing_page.css' %}">
    <link rel="stylesheet" href="{% static 'css/store/dark-theme.css' %}">
</head>
<body>
    {% include "layout/header.html" %}

    <section class="hero">
        <div class="hero-bg"></div>
        <div class="hero-content">
            <h1 class="tagline">BODAH - Nhóm 19</h1>
            <p class="subtitle">Đá bóng đừng để bóng đá - Vì đàn ông là phải mạnh mẽ trên sân</p>
        </div>
        <div class="scroll-indicator" onclick="document.getElementById('features').scrollIntoView({behavior: 'smooth'})">
            ↓
        </div>
    </section>

    <section id="products" class="products-section">
        <!-- Dùng container full-width riêng cho phần này -->
        <div style="position: relative; width: 100%; padding: 0;">
            <h2 class="section-title">Sản phẩm nổi bật</h2>
            <p class="section-subtitle">Khám phá những mặt hàng hot nhất</V>
            
            <button class="carousel-nav-btn prev" id="prevBtn">&#10094;</button>
            <button class="carousel-nav-btn next" id="nextBtn">&#10095;</button>

            <div class="products-carousel">
                {% for product in featured_products %}
                <div class="product-card">
                    <a href="{% url 'product_detail' product.id %}" style="text-decoration: none; color: inherit;">
                        <img class="product-image" 
                            src="{{ product.image }}" 
                            alt="{{ product.name }}"
                            style="width: 100%; object-fit: cover;">
                        <div class="product-info">
                            <h3 class="product-name">{{ product.name }}</h3>
                            <p class="product-price">{{ product.price|floatformat:0 }}đ</p>
                        </div>
                    </a>
                </div>
                {% endfor %}
            </div>
        </div>
    </section>

    <section id="stats" class="stats-section">
        <div class="stats-container">
            <div class="stat-item">
                <div class="stat-number">1,000+</div>
                <div class="stat-label">Sản phẩm</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">5,000+</div>
                <div class="stat-label">Khách hàng</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">20,000+</div>
                <div class="stat-label">Đơn hàng/năm</div>
            </div>
            <div class="stat-item">
                <div class="stat-number">24/7</div>
                <div class="stat-label">Hỗ trợ</div>
            </div>
        </div>
    </section>

    <section id="team" class="section team-section">
        <div class="section-content">
            <h2 class="section-title">Đội ngũ phát triển</h2>
            <p class="section-subtitle"></p>
            
            <div class="team-grid">
                <div class="team-card">
                    <img class="member-photo" src="/static/image/ava_vqb.png" alt="Vũ Quốc Bảo">
                    <h3 class="member-name">Vũ Quốc Bảo</h3>
                    <p class="student-id">MSSV: 20225694</p>
                    <div class="member-social">
                        <a href="https://www.facebook.com/quocbao.vu.25" target="_blank">
                            <img class="social-link" src="static/image/fb_logo.png" alt="Facebook-logo">
                        </a>
                        <a href="https://www.instagram.com/byllkoy259_/" target="_blank">
                            <img class="social-link" src="static/image/ig_logo.png" alt="Instagram-logo">
                        </a>                 
                    </div>
                </div>

                <div class="team-card">
                    <img class="member-photo" src="/static/image/ava_vtd.png" alt="Vũ Thành Đạt">
                    <h3 class="member-name">Vũ Thành Đạt</h3>
                    <p class="student-id">MSSV: 20225607</p>
                    <div class="member-social">
                        <a href="http://facebook.com/vu.thanh.at.57411" target="_blank">
                            <img class="social-link" src="static/image/fb_logo.png" alt="Facebook-logo">
                        </a>
                        <a href="#" target="_blank">
                            <img class="social-link" src="static/image/ig_logo.png" alt="Instagram-logo">
                        </a>
                    </div>
                </div>
                
                <div class="team-card">
                    <img class="member-photo" src="/static/image/ava_tqh.png" alt="Trịnh Quốc Hoàng">
                    <h3 class="member-name">Trịnh Quốc Hoàng</h3>
                    <p class="student-id">MSSV: 20225629</p>
                    <div class="member-social">
                        <a href="https://www.facebook.com/gnaoh69" target="_blank">
                            <img class="social-link" src="static/image/fb_logo.png" alt="Facebook-logo">
                        </a>
                        <a href="https://www.instagram.com/hoang.trnh/" target="_blank">
                            <img class="social-link" src="static/image/ig_logo.png" alt="Instagram-logo">
                        </a> 
                    </div>
                </div>
            </div>
        </div>
    </section>


    <section class="cta-section">
        <div class="cta-bg"></div>
        <div class="cta-content">
            <h2 class="section-title">Sẵn sàng trải nghiệm?</h2>
            <p class="section-subtitle">Khám phá website bán đồ bóng đá hiện đại nhất</p>
            {% if user.is_authenticated %}
                <a href="{% url 'home' %}" class="cta-button">Xem sản phẩm ngay</a>
            {% else %}
                <a href="{% url 'register' %}" class="cta-button">Đăng ký ngay</a>
            {% endif %}
        </div>
    </section>

    {% include "layout/footer.html" %}
    
    <script src="{% static 'js/theme-toggle.js' %}"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const carousel = document.querySelector('.products-carousel');
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            if (!carousel || !prevBtn || !nextBtn) return;

            const originalCards = Array.from(carousel.querySelectorAll('.product-card'));
            if (originalCards.length === 0) return;

            // Clone items: [Set 1] [Set 2 (Original)] [Set 3]
            // This allows infinite scrolling in both directions
            originalCards.forEach(card => carousel.appendChild(card.cloneNode(true)));
            originalCards.forEach(card => carousel.appendChild(card.cloneNode(true)));

            const itemsPerSet = originalCards.length;
            let currentIndex = itemsPerSet; // Start at the beginning of Set 2
            let autoPlayInterval;
            let isInteracting = false;

            function scrollToIndex(index, smooth = true) {
                const card = carousel.querySelector('.product-card');
                if(!card) return;
                
                // Tính toán lại gap dựa trên thực tế (do dùng vw)
                const style = window.getComputedStyle(carousel);
                const gap = parseFloat(style.gap) || 0;
                const itemWidth = card.offsetWidth;
                const fullItemWidth = itemWidth + gap;
                const containerWidth = carousel.offsetWidth;
                
                // Position of the start of the target item
                const itemLeft = index * fullItemWidth;
                
                // Center it: Item Left + Half Item - Half Container
                const targetScroll = itemLeft + (itemWidth / 2) - (containerWidth / 2);
                
                carousel.scrollTo({
                    left: targetScroll,
                    behavior: smooth ? 'smooth' : 'auto'
                });
            }

            function updateActiveCard() {
                const center = carousel.scrollLeft + (carousel.offsetWidth / 2);
                const allCards = carousel.querySelectorAll('.product-card');
                
                allCards.forEach((card) => {
                    const cardCenter = card.offsetLeft + (card.offsetWidth / 2);
                    const dist = Math.abs(center - cardCenter);
                    
                    if (dist < 150) {
                        card.classList.add('active');
                    } else {
                        card.classList.remove('active');
                    }
                });
            }

            // Infinite Loop Reset Logic
            function checkInfiniteLoop() {
                const N = itemsPerSet;
                // If we are in Set 3 (index >= 2N), jump back to Set 2
                if (currentIndex >= 2 * N) {
                    currentIndex = currentIndex - N;
                    scrollToIndex(currentIndex, false);
                } 
                // If we are in Set 1 (index < N), jump forward to Set 2
                else if (currentIndex < N) {
                    currentIndex = currentIndex + N;
                    scrollToIndex(currentIndex, false);
                }
            }

            // Navigation
            function next() {
                currentIndex++;
                scrollToIndex(currentIndex, true);
                resetAutoPlay();
            }

            function prev() {
                currentIndex--;
                scrollToIndex(currentIndex, true);
                resetAutoPlay();
            }

            // Auto Play (5 seconds)
            function startAutoPlay() {
                clearInterval(autoPlayInterval);
                autoPlayInterval = setInterval(() => {
                    if (!isInteracting) {
                        next();
                    }
                }, 5000);
            }

            function resetAutoPlay() {
                clearInterval(autoPlayInterval);
                startAutoPlay();
            }

            // Event Listeners
            nextBtn.addEventListener('click', next);
            prevBtn.addEventListener('click', prev);

            let scrollTimeout;
            carousel.addEventListener('scroll', () => {
                updateActiveCard();
                
                // Detect scroll end to check infinite loop
                clearTimeout(scrollTimeout);
                scrollTimeout = setTimeout(() => {
                    checkInfiniteLoop();
                }, 100);
            });

            carousel.addEventListener('mouseenter', () => isInteracting = true);
            carousel.addEventListener('mouseleave', () => isInteracting = false);

            // Initialize
            setTimeout(() => {
                scrollToIndex(currentIndex, false);
                updateActiveCard();
                startAutoPlay();
            }, 100);
            
            // Handle resize
            window.addEventListener('resize', () => scrollToIndex(currentIndex, false));
        });
    </script>
</body>
</html>